'use strict';

var Git = require('nodegit');

module.exports = function(repo){

    return repo.getBranchCommit('master')
    .then(function(commit){
        console.log(commit.id().toString());
        console.log(commit.message());

        return commit.getTree()
        .then(function(tree){
            tree.diff()
            .then(function(diffList){
                console.log('diffList', diffList);
            })
            .catch(function(error){
                console.error(error);
            });

            tree.entries().forEach(function(entry){
                if (entry.isDirectory()){
                    console.log('dir', entry.filename());
                } else if (entry.isFile()){
                    console.log('file', entry.filename());
                }
            });
        })
        .then(function(){
            return commit.getDiff();
        })
        .then(function(diffList){

            return; //
            diffList
            .map(function(diff){
                return diff.patches();
            })
            .forEach(function(patches){

                patches.forEach(function(patch){
                    console.log('path', patch.oldFile().path(), patch.newFile().path());

                    patch.hunks().forEach(function(hunk){
                        console.log('=====');
                        console.log(hunk.header().trim());
                        hunk.lines().forEach(function(line){
                            console.log(String.fromCharCode(line.origin()) +
                            line.content().trim());

                        });
                    });
                });

            });
        });
    });

};
